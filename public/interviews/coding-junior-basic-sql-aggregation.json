{
  "id": "coding-junior-basic-sql-aggregation",
  "category": "coding",
  "level": "junior",
  "title": "SQL Aggregation Basics",
  "description": "Write basic aggregation queries, then explain your understanding of how GROUP BY works.",
  "estimatedMinutes": 20,
  "tags": [
    "aggregation",
    "group-by",
    "count"
  ],
  "rounds": [
    {
      "id": "round-1",
      "type": "sql",
      "questionType": "write",
      "timeMinutes": 8,
      "title": "Count Orders by Status",
      "description": "<p>Given an <code>orders</code> table, write a query that returns the count of orders\nfor each status. Order the results by count descending.</p>\n",
      "tables": [
        {
          "name": "orders",
          "visibleData": "order_id,customer_id,status,amount\n1,101,completed,50.00\n2,102,pending,30.00\n3,101,completed,75.00\n4,103,cancelled,20.00\n5,102,completed,60.00\n6,104,pending,45.00",
          "hiddenDatasets": [
            "order_id,customer_id,status,amount\n1,201,completed,100.00\n2,202,pending,50.00\n3,203,completed,75.00\n4,204,cancelled,25.00\n5,205,completed,60.00\n6,206,completed,80.00\n7,207,pending,35.00\n8,208,cancelled,90.00"
          ]
        }
      ],
      "expectedOutput": "status,order_count\ncompleted,3\npending,2\ncancelled,1\n",
      "expectedOutputQuery": "SELECT status, COUNT(*) as order_count\nFROM orders\nGROUP BY status\nORDER BY order_count DESC\n",
      "hints": [
        "Use COUNT(*) with GROUP BY",
        "ORDER BY can reference aliases"
      ]
    },
    {
      "id": "round-2",
      "type": "quiz",
      "questionType": "quiz",
      "timeMinutes": 4,
      "title": "Explain Your Approach",
      "description": "<p>Let&#39;s make sure you understand how GROUP BY works under the hood.</p>\n",
      "questions": [
        {
          "question": "What happens if you SELECT a column that is not in GROUP BY and not aggregated?",
          "options": [
            "SQL error - column must be in GROUP BY or an aggregate",
            "It returns the first value found",
            "It returns NULL",
            "It returns all values concatenated"
          ],
          "correctAnswer": 0,
          "explanation": "Standard SQL requires that every selected column is either in the GROUP BY clause or wrapped in an aggregate function. Most databases will raise an error."
        },
        {
          "question": "If you used COUNT(customer_id) instead of COUNT(*), what would be different?",
          "options": [
            "COUNT(column) skips NULLs, COUNT(*) counts all rows",
            "No difference - they always return the same result",
            "COUNT(column) is faster",
            "COUNT(*) skips NULLs"
          ],
          "correctAnswer": 0,
          "explanation": "COUNT(*) counts all rows including those with NULL values. COUNT(column) only counts rows where that specific column is not NULL."
        }
      ]
    },
    {
      "id": "round-3",
      "type": "sql",
      "questionType": "write",
      "timeMinutes": 8,
      "title": "Revenue by Status",
      "description": "<p>Now extend your analysis: write a query that returns each status with\nboth the order count and total revenue (sum of amount). Only include\nstatuses with total revenue above 50. Order by total revenue descending.</p>\n",
      "tables": [
        {
          "name": "orders",
          "visibleData": "order_id,customer_id,status,amount\n1,101,completed,50.00\n2,102,pending,30.00\n3,101,completed,75.00\n4,103,cancelled,20.00\n5,102,completed,60.00\n6,104,pending,45.00",
          "hiddenDatasets": [
            "order_id,customer_id,status,amount\n1,201,completed,100.00\n2,202,pending,50.00\n3,203,completed,75.00\n4,204,cancelled,25.00\n5,205,completed,60.00\n6,206,completed,80.00\n7,207,pending,35.00\n8,208,cancelled,90.00"
          ]
        }
      ],
      "expectedOutput": "status,order_count,total_revenue\ncompleted,3,185.00\npending,2,75.00\n",
      "expectedOutputQuery": "SELECT status, COUNT(*) as order_count, SUM(amount) as total_revenue\nFROM orders\nGROUP BY status\nHAVING SUM(amount) > 50\nORDER BY total_revenue DESC\n",
      "hints": [
        "Use HAVING to filter after GROUP BY",
        "SUM() for total revenue"
      ]
    }
  ]
}